# Modbus 存储区、功能码、地址模型



## Modbus 存储区

Modbus协议主要用于实现不同设备间的数据交互和通信，为了管理数据，引入了存储区的概念。类似于可编程逻辑控制器（PLC）中的存储区。

不同品牌的PLC定义了各自特有的存储区，比如：

- 西门子PLC：定义了M、Q、V、DB存储区
- 三菱PLC：定义了X、Y、M、D、W存储区

### 存储区的分类

Modbus协议的存储区根据数据类型分为：

- 布尔类型：用于存储布尔变量，被称为**线圈**。
- 字类型：用于存储一般数据，被称为**寄存器**。

根据存储区的读写特性，存储区分为：

- 只读类型：只读存储区仅允许读取数据，不能写入，在Modbus协议中，只读存储区被称为**输入**。
- 可读可写类型：可读可写存储区允许读取和写入数据，在Modbus协议中，可读可写存储区被称为**输出**。

由此根据数据类型和读写特性，Modbus协议规定了四种类型存储区：

| 存储区名称                 | 数据类型  | 读写特性 | 存储区代号 |
| -------------------------- | --------- | -------- | ---------- |
| 输出线圈                   | 布尔/线圈 | 可读可写 | 0区        |
| 输入线圈                   | 布尔/线圈 | 只读     | 1区        |
| 输入寄存器                 | 字/寄存器 | 只读     | 3区        |
| 输出寄存器（保持型寄存器） | 字/寄存器 | 可读可写 | 4区        |

- 输出寄存器在Modbus协议规范中一般称为**保持型寄存器**。
- 根据Modbus协议的规定，每个存储区都有一个特定的代号，用数字形式表示，注意没有2区。



## Modbus 功能码

上述四个存储区，根据读取和写入操作，组合出下述几种行为：

- 读取输入线圈
- 读取输出线圈
- 读取输入寄存器
- 读取输出寄存器（读取保持型寄存器）
- 写入输出线圈
  - 写入单个线圈
  - 写入多个线圈
- 写入输出寄存器
  - 写入单个寄存器
  - 写入多个寄存器

注意：输入线圈和输入寄存器是只读的，不能进行写入，因此可以进行写入操作的存储区只有输出线圈和输出寄存器。而写入方式有单个写入和多个写入。因此写入操作最终分为四种行为，即写入单个线圈，写入多个线圈，写入单个寄存器，写入多个寄存器。

以上8中行为编号，形成Modbus的8大功能码：

| 功能码    | 说明                                   |
| --------- | -------------------------------------- |
| 0x 01     | 读取输出线圈                           |
| 0x 02     | 读取输入线圈                           |
| 0x 03     | **读取保持型寄存器**（读取输出寄存器） |
| 0x 04     | 读取输入寄存器                         |
| 0x 05     | 写入单个线圈                           |
| 0x 06     | 写入单个寄存器                         |
| ==0x 0F== | 写入**多个**线圈                       |
| ==0x 10== | 写入**多个**寄存器                     |

注意：上述中的输入和输出，非字面意思的“输入”和“输出”，而是应当作“只读”和“可读可写”来代替。

### 异常功能码

异常功能码通常以8开头，如0x81，0x83等，用来表示不同类型的通信异常情况。

异常功能码与正常功能码之间的关系为：

异常功能码 = 正常功能码 + 0x80





## Modbus 地址模型

